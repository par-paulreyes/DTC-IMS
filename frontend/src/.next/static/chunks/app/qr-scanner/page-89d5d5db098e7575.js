(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[963],{4037:(e,t,r)=>{Promise.resolve().then(r.bind(r,8246))},8246:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(3365),s=r(1521),o=r(1497),n=r.n(o),l=r(2365),c=r.n(l),i=r(8660),d=r(627),m=r(5611);function h(){let e=(0,s.useRef)(null),[t,r]=(0,s.useState)(null),[o,l]=(0,s.useState)(!1),[h,u]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),[f,b]=(0,s.useState)(""),[p,v]=(0,s.useState)(null),w=(0,d.useRouter)();(0,s.useEffect)(()=>{localStorage.getItem("token")||w.push("/login")},[w]),(0,s.useEffect)(()=>{(async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),v(!0),b("")}catch(e){console.error("Camera permission error:",e),v(!1),"http:"===window.location.protocol&&"localhost"!==window.location.hostname?b("Camera access requires HTTPS. Please use HTTPS or localhost for camera functionality."):e instanceof Error?"NotAllowedError"===e.name?b("Camera permission denied. Please allow camera access in your browser settings."):"NotFoundError"===e.name?b("No camera found. Please connect a camera and try again."):b("Camera error: ".concat(e.message)):b("Camera access failed. Please check your browser settings.")}})()},[]);let y=(0,s.useCallback)(()=>{if(!e.current)return;let t=e.current.getScreenshot();if(t)try{let e=t.split(",")[1],a=atob(e),s=a.length,o=new Uint8ClampedArray(s);for(let e=0;e<s;e++)o[e]=a.charCodeAt(e);let n=document.createElement("canvas"),l=n.getContext("2d");if(!l)return;let i=new window.Image;i.onload=()=>{n.width=i.width,n.height=i.height,l.drawImage(i,0,0);let e=l.getImageData(0,0,i.width,i.height),t=c()(e.data,i.width,i.height);t&&r(t.data)},i.src=t}catch(e){u("Camera or decoding error")}},[]);(0,s.useEffect)(()=>{if(t||!p)return;let e=setInterval(y,1e3);return()=>clearInterval(e)},[y,t,p]),(0,s.useEffect)(()=>{if(!t)return;l(!0),u(""),x(!1);let e=localStorage.getItem("token");if(!e){u("Please log in to scan QR codes"),l(!1),w.push("/login");return}i.A.get((0,m.e9)("/items/qr/".concat(encodeURIComponent(t))),{headers:{Authorization:e}}).then(e=>{l(!1),u(""),x(!0),setTimeout(()=>{w.push("/inventory/".concat(e.data.id))},1e3)}).catch(e=>{var r,a,s,o;(null==(r=e.response)?void 0:r.status)===404?w.push("/inventory/add?qr=".concat(encodeURIComponent(t))):(null==(a=e.response)?void 0:a.status)===401?(u("Authentication failed. Please log in again."),localStorage.removeItem("token"),w.push("/login")):u("Error fetching item: "+((null==(o=e.response)||null==(s=o.data)?void 0:s.message)||e.message))}).finally(()=>l(!1))},[t,w]);let N=async()=>{b(""),v(null);try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),v(!0)}catch(e){v(!1),b("Failed to access camera. Please check permissions.")}};return(0,a.jsxs)("div",{className:"min-h-screen pt-8 pb-20 flex flex-col items-center bg-gray-50",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"QR Scanner"}),f?(0,a.jsxs)("div",{className:"w-80 h-80 rounded border-4 border-red-500 bg-gray-100 flex flex-col items-center justify-center p-6 text-center",children:[(0,a.jsx)("svg",{className:"w-16 h-16 text-red-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("p",{className:"text-red-600 font-semibold mb-2",children:"Camera Not Available"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:f}),(0,a.jsx)("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Retry Camera"})]}):!1===p?(0,a.jsxs)("div",{className:"w-80 h-80 rounded border-4 border-yellow-500 bg-gray-100 flex flex-col items-center justify-center p-6 text-center",children:[(0,a.jsx)("svg",{className:"w-16 h-16 text-yellow-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("p",{className:"text-yellow-600 font-semibold mb-2",children:"Checking Camera..."})]}):(0,a.jsx)(n(),{audio:!1,ref:e,screenshotFormat:"image/png",videoConstraints:{facingMode:"environment"},className:"w-80 h-80 rounded border-4 border-blue-500",onUserMediaError:e=>{console.error("Webcam error:",e),b("Failed to start camera. Please check permissions.")}}),h&&(0,a.jsx)("div",{className:"text-red-500 mt-2",children:h}),t&&(0,a.jsxs)("div",{className:"mt-4 text-green-600 font-bold",children:["Scanned QR: ",t]}),o&&(0,a.jsx)("div",{className:"mt-4 text-blue-600",children:"Loading..."}),g&&(0,a.jsx)("div",{className:"mt-4 text-green-600 font-bold",children:"Item found! Redirecting to details..."}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-white rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Manual QR Code Entry"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-3",children:"If camera is not working, you can manually enter a QR code:"}),(0,a.jsx)("button",{onClick:()=>{let e=prompt("Enter QR code:");e&&r(e)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Enter QR Code Manually"})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[844,602,883,347,870,358],()=>t(4037)),_N_E=e.O()}]);